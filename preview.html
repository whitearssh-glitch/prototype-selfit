<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SELFit – Preview</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet" />
  <style>
    @font-face {
      font-family: 'ARCO';
      font-style: normal;
      font-weight: 400;
      font-display: swap;
      src: url('https://db.onlinewebfonts.com/t/e31fd2ef9bcf0adbb98de3b059d2b88a.woff2') format('woff2');
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #ffb6c1 0%, #ffc0cb 40%, #ffe4ec 100%);
      color: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100%;
      overflow-x: auto;
    }
    .app {
      display: flex;
      flex-direction: column;
      width: 414px;
      min-width: 414px;
      max-width: 100%;
      min-height: 100%;
      max-height: 844px;
      margin: 0 auto;
      padding: 0.75rem;
      background: linear-gradient(135deg, #ffb6c1 0%, #ffc0cb 40%, #ffe4ec 100%);
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.06);
      flex-shrink: 0;
    }
    @media (min-height: 800px) {
      .app { min-height: 667px; border-radius: 1.25rem; }
    }
    .app-header {
      position: relative;
      width: 100%;
      min-width: 0;
      font-size: 0.9rem;
      font-weight: bold;
      padding: 0.5rem 1rem;
      flex-shrink: 0;
      background: linear-gradient(135deg, #880e4f 0%, #ad1457 50%, #d81b60 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-align: center;
      border-radius: 0 0 0.5rem 0.5rem;
      box-sizing: border-box;
    }
    .app-header::after {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: 1.5px;
      background: linear-gradient(90deg, #880e4f 0%, #ad1457 50%, #d81b60 100%);
      border-radius: 2px;
    }
    .app-content { position: relative; }
    .app-overlay {
      position: fixed;
      inset: 0;
      z-index: 1000;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .app-overlay > * { pointer-events: auto; }
    .corner-select-screen {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #ffb6c1 0%, #ffc0cb 40%, #ffe4ec 100%);
      border: 6px solid #ad1457;
      border-radius: inherit;
      box-sizing: border-box;
    }
    .corner-select-inner {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1.25rem;
    }
    .corner-select-btn {
      min-width: 10rem;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 1rem;
      background: linear-gradient(135deg, #880e4f 0%, #ad1457 50%, #d81b60 100%);
      color: #fff;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: filter 0.15s ease;
    }
    .corner-select-btn:hover { filter: brightness(1.08); }
    .corner-intro-screen {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #ffb6c1 0%, #ffc0cb 40%, #ffe4ec 100%);
      border: 6px solid #ad1457;
      border-radius: inherit;
      box-sizing: border-box;
      cursor: pointer;
    }
    .corner-intro-inner {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
    }
    .corner-intro-step {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.35rem 0.75rem;
      border-radius: 0.75rem;
      background: linear-gradient(135deg, #880e4f 0%, #ad1457 50%, #d81b60 100%);
      font-size: 0.75rem;
      font-weight: 600;
      color: #fff;
    }
    .corner-intro-title {
      margin: 0;
      font-size: 2.75rem;
      font-weight: 700;
      background: linear-gradient(135deg, #880e4f 0%, #ad1457 40%, #d81b60 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-align: center;
      letter-spacing: 0.02em;
    }
    .topic-box {
      padding: 0.4rem 1rem;
      border-radius: 1rem;
      background: linear-gradient(135deg, #880e4f 0%, #ad1457 50%, #d81b60 100%);
      border: none;
      font-size: 0.9rem;
      color: #fff;
      text-align: center;
      align-self: center;
      margin-bottom: 0.75rem;
      flex-shrink: 0;
    }
    .screen-content {
      flex: 1;
      position: relative;
      display: flex;
      flex-direction: column;
      min-height: 0;
      width: 100%;
    }
    .screen-center {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 0;
      width: 100%;
      padding-top: 0.5rem;
    }
    .screen-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      min-height: 320px;
      width: 100%;
    }
    .screen-main--vertical-center { justify-content: center; }
    .screen-bottom {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 60px;
      width: 100%;
      margin-top: 0.5rem;
      padding-bottom: 0.5rem;
      flex-shrink: 0;
    }
    .screen-next {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .screen-next--top-right {
      position: absolute;
      top: -0.5rem;
      right: 0;
    }
    .text-box {
      width: 100%;
      max-width: 28rem;
      margin: 0 auto;
      padding: 1rem 1.25rem;
      border-radius: 1.75rem;
      border: 2px solid transparent;
      background: linear-gradient(white, white) padding-box,
                  linear-gradient(135deg, #880e4f 0%, #ad1457 50%, #d81b60 100%) border-box;
      background-origin: border-box;
      background-clip: padding-box, border-box;
      font-size: 1.1rem;
      line-height: 1.5;
      text-align: center;
      white-space: pre-line;
      box-sizing: border-box;
    }
    .text-box-two-lines { display: flex; flex-direction: column; gap: 0.25rem; }
    .text-box-two-lines .text-box-line {
      display: block;
      font-weight: bold;
      background: linear-gradient(135deg, #880e4f 0%, #ad1457 50%, #d81b60 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .main-text {
      font-size: 1.5rem;
      font-weight: 600;
      text-align: center;
      padding: 1rem;
    }
    .main-text--two-lines { margin: 0; padding: 0 1rem; line-height: 1.2; }
    .main-text.main-text--sub { font-size: 1.1rem; color: #666; margin-top: -0.2em; }
    .main-text-blank-box {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 4rem;
      height: 1.4em;
      margin-left: 0.2em;
      padding: 0 0.4em;
      vertical-align: middle;
      border: 2px solid rgba(255, 255, 255, 0.9);
      border-radius: 0.5rem;
      background: rgba(255, 255, 255, 0.95);
      box-sizing: border-box;
    }
    .main-text-blank-box__hint {
      color: #aaa;
      font-size: inherit;
      font-weight: inherit;
    }
    .main-text-fill--cyan {
      background: linear-gradient(135deg, #26c6da 0%, #5c6bc0 50%, #7e57c2 100%);
      background-repeat: no-repeat;
      background-position: 0 0;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: main-text-gradient-fill 1.4s ease-out forwards;
    }
    .main-text--gradient-sequential {
      background: linear-gradient(90deg, #880e4f 0%, #ad1457 20%, #d81b60 40%, #26c6da 40%, #5c6bc0 70%, #7e57c2 100%);
      background-repeat: no-repeat;
      background-position: 0 0;
      background-size: 0% 100%;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: main-text-gradient-fill 1.4s ease-out forwards;
    }
    .speed-display {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 0.25rem;
      width: 100%;
      padding: 0 0.5rem 0.25rem;
      margin-bottom: 0.25rem;
      flex-shrink: 0;
    }
    .speed-display-item {
      font-size: 0.7rem;
      font-weight: 600;
      color: #880e4f;
      padding: 0.2rem 0.5rem;
      border-radius: 0.4rem;
      background: rgba(255, 255, 255, 0.7);
    }
    .speed-display-item--slow {
      background: linear-gradient(135deg, #880e4f 0%, #ad1457 50%, #d81b60 100%);
      color: #fff;
    }
    .speed-display--fast-active .speed-display-item--slow {
      background: #fff;
      color: #880e4f;
    }
    .speed-display--fast-active .speed-display-item--fast {
      background: linear-gradient(135deg, #880e4f 0%, #ad1457 50%, #d81b60 100%);
      color: #fff;
    }
    .speed-display-sep { font-size: 0.65rem; color: #ad1457; opacity: 0.8; }
    .main-text--gradient {
      background: linear-gradient(135deg, #880e4f 0%, #ad1457 50%, #d81b60 100%);
      background-repeat: no-repeat;
      background-position: 0 0;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: main-text-gradient-fill 1.4s ease-out forwards;
    }
    @keyframes main-text-gradient-fill {
      from { background-size: 0% 100%; }
      to { background-size: 100% 100%; }
    }
    .teacher-image {
      max-width: 320px;
      max-height: 400px;
      width: 100%;
      object-fit: contain;
    }
    .teacher-image--shake {
      animation: teacher-shake 1.2s ease-in-out infinite;
    }
    @keyframes teacher-shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-6px); }
      75% { transform: translateX(6px); }
    }
    .screen1-tap-hint {
      margin-top: 0.5rem;
      font-size: 0.85rem;
      color: #888;
      text-align: center;
    }
    .next-btn {
      padding: 0.35rem 0.75rem;
      border: none;
      border-radius: 0.55rem;
      background: linear-gradient(135deg, #880e4f 0%, #ad1457 50%, #d81b60 100%);
      color: #fff;
      font-size: 0.72rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.15em;
      flex-shrink: 0;
    }
    .next-btn:hover:not(:disabled) { filter: brightness(1.05); }
    .next-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .mic-btn {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(135deg, #880e4f 0%, #ad1457 50%, #d81b60 100%);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 12px rgba(173, 20, 87, 0.35);
      transition: transform 0.15s ease;
    }
    .mic-btn:hover { transform: scale(1.05); }
    .mic-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .mic-btn svg { width: 28px; height: 28px; }
    .checkmark-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pop 0.3s ease;
    }
    @keyframes pop {
      0% { transform: translate(-50%, -50%) scale(0); }
      70% { transform: translate(-50%, -50%) scale(1.1); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }
    .checkmark-popup svg { width: 48px; height: 48px; color: #2e7d32; }
    .speed-up-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      padding: 1rem 1.5rem;
      border-radius: 1rem;
      background: linear-gradient(135deg, #880e4f 0%, #ad1457 50%, #d81b60 100%);
      color: #fff;
      font-size: 1.25rem;
      font-weight: 700;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      animation: pop 0.3s ease;
      pointer-events: auto;
    }

    /* Screen 7 only: Good! stamp popup when Next is clicked */
    .screen7-stamp-popup {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      cursor: pointer;
      animation: screen7-stamp-pop 0.4s ease-out;
    }
    @keyframes screen7-stamp-pop {
      0% { opacity: 0; transform: scale(0.5); }
      70% { transform: scale(1.08); }
      100% { opacity: 1; transform: scale(1); }
    }
    .screen7-stamp-circle {
      width: 138px;
      height: 138px;
      border-radius: 50%;
      background: linear-gradient(135deg, #5a0a35 0%, #8b1045 35%, #b81a52 65%, #e91e63 100%);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .screen7-stamp-svg { width: 100%; height: 100%; }
    .screen7-stamp-text {
      font-family: 'ARCO', sans-serif;
      font-size: 26px;
      font-weight: normal;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header" id="app-header">Basic 01 Day 01</header>
    <div class="app-content" id="app-content"></div>
  </div>
  <div id="app-overlay" class="app-overlay"></div>

  <script>
    var CORNER_TITLE = 'Patterns';
    var CORNER_STEP_2 = 'STEP 2';
    var CORNER_TITLE_2 = 'Speed Up';
    const CENTER_TEXT_S2 = 'Hello, SELENA!';
    const CENTER_TEXT_S4 = 'Nice to meet you!';
    const CENTER_TEXT_S6 = 'I am';
    const CENTER_TEXT_S9_LINE1 = 'Nice to meet you!';
    const CENTER_TEXT_S9_LINE2 = '만나서 반가워요!';
    var SCREEN9_AUDIO = './nice-to-meet-you.mp3';
    const CENTER_TEXT_S10_LINE1 = 'Nice to meet you!';
    const CENTER_TEXT_S10_LINE2 = '만나서 반가워요!';
    const CENTER_TEXT_S11_LINE1 = 'I am';
    const CENTER_TEXT_S11_LINE2 = '나는 ~예요, 해요';
    var SCREEN11_AUDIO = './i-am.mp3';
    const CENTER_TEXT_S12_LINE1 = 'I am';
    const CENTER_TEXT_S12_LINE2 = '나는 ~예요, 해요';
    const CENTER_TEXT_S13_LINE1_PREFIX = 'I am ';
    const CENTER_TEXT_S13_FILL = 'happy';
    const CENTER_TEXT_S13_LINE2 = '나는 행복해요.';
    var SCREEN13_AUDIO = './i-am-happy.mp3';
    const CENTER_TEXT_S15_LINE1_PREFIX = 'I am ';
    const CENTER_TEXT_S15_FILL = 'happy';
    const CENTER_TEXT_S15_LINE2 = '나는 행복해요.';
    var SCREEN15_AUDIO = './i-am-happy.mp3';
    const CENTER_TEXT_S16_LINE1_PREFIX = 'I am ';
    const CENTER_TEXT_S16_FILL = 'a student';
    const CENTER_TEXT_S16_LINE2 = '나는 학생이에요.';
    var SCREEN16_AUDIO = './i-am-a-student.mp3';
    const CENTER_TEXT_S17_LINE1_PREFIX = 'I am ';
    const CENTER_TEXT_S17_FILL = 'a student';
    const CENTER_TEXT_S17_LINE2 = '나는 학생이에요.';
    const CENTER_TEXT_S18_LINE1_PREFIX = 'I am ';
    const CENTER_TEXT_S18_FILL = 'Peter';
    const CENTER_TEXT_S18_LINE2 = '나는 피터예요.';
    var TEXT_BOX_LINE1 = 'Hello, everyone!';
    var TEXT_BOX_LINE2 = 'Welcome to SELFit!';

    function renderCornerSelect() {
      return (
        '<div class="corner-select-screen">' +
          '<div class="corner-select-inner">' +
            '<button type="button" class="corner-select-btn" id="btn-step1" aria-label="STEP 1 Patterns">STEP 1</button>' +
            '<button type="button" class="corner-select-btn" id="btn-step2" aria-label="STEP 2 Speed Up">STEP 2</button>' +
          '</div>' +
        '</div>'
      );
    }

    function renderCornerIntro(step, title) {
      step = step || 'STEP 1';
      title = title || CORNER_TITLE;
      return (
        '<div class="corner-intro-screen" id="corner-intro-screen">' +
          '<div class="corner-intro-inner">' +
            '<span class="corner-intro-step">' + step + '</span>' +
            '<h1 class="corner-intro-title">' + title + '</h1>' +
          '</div>' +
        '</div>'
      );
    }

    function playDingDong() {
      try {
        var ctx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(freq, start, duration) {
          var osc = ctx.createOscillator();
          var gain = ctx.createGain();
          osc.connect(gain);
          gain.connect(ctx.destination);
          osc.frequency.value = freq;
          osc.type = 'sine';
          gain.gain.setValueAtTime(0.2, start);
          gain.gain.exponentialRampToValueAtTime(0.01, start + duration);
          osc.start(start);
          osc.stop(start + duration);
        }
        playTone(523, 0, 0.15);
        playTone(659, 0.2, 0.2);
      } catch (e) {}
    }

    function playNotificationSound() {
      try {
        var ctx = new (window.AudioContext || window.webkitAudioContext)();
        var osc = ctx.createOscillator();
        var gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.frequency.value = 880;
        osc.type = 'sine';
        gain.gain.setValueAtTime(0.25, 0);
        gain.gain.exponentialRampToValueAtTime(0.01, 0.1);
        osc.start(0);
        osc.stop(0.1);
      } catch (e) {}
    }

    var TOPIC_TEXT = 'TOPIC: Self-introduction';
    var SCREEN1_AUDIO = ['./screen1-1.mp3', './screen1-2.mp3'];
    var screen1State = { audioStarted: false, audioEnded: false, isPlaying: false, index: 0 };
    var SCREEN3_AUDIO = ['./screen3-1.mp3', './screen3-2.mp3', './screen3-3.mp3'];
    var screen3State = { audioStarted: false, audioEnded: false, isPlaying: false, index: 0 };
    var TEXT_BOX_S3_LINE1 = 'Nice to meet you!';
    var TEXT_BOX_S3_LINE2 = '만나서 반가워요!';
    var SCREEN5_AUDIO = ['./screen5-1.mp3', './screen5-2.mp3', './screen5-3.mp3'];
    var screen5State = { audioStarted: false, audioEnded: false, isPlaying: false, index: 0 };
    var TEXT_BOX_S5_LINE1 = 'I am';
    var TEXT_BOX_S5_LINE2 = '나는 ~예요, ~해요';
    var SCREEN7_AUDIO = ['./screen7-1.mp3', './screen7-2.mp3'];
    var screen7State = { audioStarted: false, audioEnded: false, isPlaying: false, index: 0, nextClicked: false, showStampPopup: false };
    var TEXT_BOX_S7_LINE1 = "Let's move on.";
    var TEXT_BOX_S7_LINE2 = 'Here we go!';

    function renderScreen1(state) {
      var audioStarted = state.audioStarted;
      var audioEnded = state.audioEnded;
      var isPlaying = state.isPlaying;
      var imgClass = 'teacher-image' + (isPlaying ? ' teacher-image--shake' : '');
      var tapHintHtml = '';
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            '<div class="screen-main screen-main--vertical-center">' +
              '<img src="./ch.png" alt="Teacher" class="' + imgClass + '" />' +
              tapHintHtml +
            '</div>' +
            '<div class="screen-bottom">' +
              '<div class="text-box text-box-two-lines">' +
              '<span class="text-box-line">' + TEXT_BOX_LINE1 + '</span>' +
              '<span class="text-box-line">' + TEXT_BOX_LINE2 + '</span>' +
            '</div>' +
            '</div>' +
          '</div>' +
        '</div>'
      );
    }

    // Screen 1: play screen1-1 then screen1-2 after user tap (browsers block autoplay)
    function playScreen1Next() {
      if (screen1State.index >= SCREEN1_AUDIO.length) {
        screen1State.isPlaying = false;
        screen1State.audioEnded = true;
        mount();
        setTimeout(goNext, 1200);
        return;
      }
      var audio = new Audio(SCREEN1_AUDIO[screen1State.index]);
      audio.onended = function () {
        screen1State.index++;
        playScreen1Next();
      };
      audio.onerror = function () {
        screen1State.index++;
        playScreen1Next();
      };
      screen1State.isPlaying = true;
      mount();
      var p = audio.play();
      if (p && typeof p.catch === 'function') p.catch(function () {});
    }

    function onScreen1Tap() {
      if (!screen1State.audioStarted) {
        screen1State.audioStarted = true;
        mount();
        playScreen1Next();
      }
    }

    function renderScreen3(state) {
      var audioStarted = state.audioStarted;
      var audioEnded = state.audioEnded;
      var isPlaying = state.isPlaying;
      var imgClass = 'teacher-image' + (isPlaying ? ' teacher-image--shake' : '');
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            '<div class="screen-main screen-main--vertical-center">' +
              '<img src="./ch.png" alt="Teacher" class="' + imgClass + '" />' +
            '</div>' +
            '<div class="screen-bottom">' +
              '<div class="text-box text-box-two-lines">' +
              '<span class="text-box-line">' + TEXT_BOX_S3_LINE1 + '</span>' +
              '<span class="text-box-line">' + TEXT_BOX_S3_LINE2 + '</span>' +
            '</div>' +
            '</div>' +
          '</div>' +
        '</div>'
      );
    }

    function playScreen3Next() {
      if (screen3State.index >= SCREEN3_AUDIO.length) {
        screen3State.isPlaying = false;
        screen3State.audioEnded = true;
        mount();
        setTimeout(goNext, 1200);
        return;
      }
      var audio = new Audio(SCREEN3_AUDIO[screen3State.index]);
      audio.onended = function () {
        screen3State.index++;
        playScreen3Next();
      };
      audio.onerror = function () {
        screen3State.index++;
        playScreen3Next();
      };
      screen3State.isPlaying = true;
      mount();
      var p = audio.play();
      if (p && typeof p.catch === 'function') p.catch(function () {});
    }

    function onScreen3Tap() {
      if (!screen3State.audioStarted) {
        screen3State.audioStarted = true;
        mount();
        playScreen3Next();
      }
    }

    function renderScreen5(state) {
      var audioEnded = state.audioEnded;
      var isPlaying = state.isPlaying;
      var imgClass = 'teacher-image' + (isPlaying ? ' teacher-image--shake' : '');
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            '<div class="screen-main screen-main--vertical-center">' +
              '<img src="./ch.png" alt="Teacher" class="' + imgClass + '" />' +
            '</div>' +
            '<div class="screen-bottom">' +
              '<div class="text-box text-box-two-lines">' +
              '<span class="text-box-line">' + TEXT_BOX_S5_LINE1 + '</span>' +
              '<span class="text-box-line">' + TEXT_BOX_S5_LINE2 + '</span>' +
            '</div>' +
            '</div>' +
          '</div>' +
        '</div>'
      );
    }

    function playScreen5Next() {
      if (screen5State.index >= SCREEN5_AUDIO.length) {
        screen5State.isPlaying = false;
        screen5State.audioEnded = true;
        mount();
        setTimeout(goNext, 1200);
        return;
      }
      var audio = new Audio(SCREEN5_AUDIO[screen5State.index]);
      audio.onended = function () {
        screen5State.index++;
        playScreen5Next();
      };
      audio.onerror = function () {
        screen5State.index++;
        playScreen5Next();
      };
      screen5State.isPlaying = true;
      mount();
      var p = audio.play();
      if (p && typeof p.catch === 'function') p.catch(function () {});
    }

    function onScreen5Tap() {
      if (!screen5State.audioStarted) {
        screen5State.audioStarted = true;
        mount();
        playScreen5Next();
      }
    }

    function renderScreen7(state) {
      var audioEnded = state.audioEnded;
      var nextClicked = state.nextClicked;
      var isPlaying = state.isPlaying;
      var showStampPopup = state.showStampPopup;
      var imgClass = 'teacher-image' + (isPlaying ? ' teacher-image--shake' : '');
      var stampPopupHtml = showStampPopup
        ? '<div class="screen7-stamp-popup" role="button" tabindex="0" aria-label="다음으로">' +
            '<div class="screen7-stamp-circle">' +
              '<svg class="screen7-stamp-svg" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">' +
                '<defs><path id="stamp-small-star" d="M0 -2.1 L0.5 -0.5 L2.2 -0.5 L0.8 0.5 L1.3 2.1 L0 1.1 L-1.3 2.1 L-0.8 0.5 L-2.2 -0.5 L-0.5 -0.5 Z" fill="#fff"/></defs>' +
                '<circle cx="60" cy="60" r="52" fill="none" stroke="#fff" stroke-width="3"/>' +
                '<use href="#stamp-small-star" transform="translate(98, 38) scale(2)"/>' +
                '<use href="#stamp-small-star" transform="translate(82, 22) scale(2)"/>' +
                '<use href="#stamp-small-star" transform="translate(60, 16) scale(2)"/>' +
                '<use href="#stamp-small-star" transform="translate(38, 22) scale(2)"/>' +
                '<use href="#stamp-small-star" transform="translate(22, 38) scale(2)"/>' +
                '<use href="#stamp-small-star" transform="translate(22, 82) scale(2)"/>' +
                '<use href="#stamp-small-star" transform="translate(38, 98) scale(2)"/>' +
                '<use href="#stamp-small-star" transform="translate(60, 104) scale(2)"/>' +
                '<use href="#stamp-small-star" transform="translate(82, 98) scale(2)"/>' +
                '<use href="#stamp-small-star" transform="translate(98, 82) scale(2)"/>' +
                '<text x="60" y="62" text-anchor="middle" dominant-baseline="central" class="screen7-stamp-text" fill="#fff">GOOD!</text>' +
              '</svg>' +
            '</div>' +
          '</div>'
        : '';
      return (
        '<div class="screen-content">' +
          stampPopupHtml +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            '<div class="screen-main screen-main--vertical-center">' +
              '<img src="./ch.png" alt="Teacher" class="' + imgClass + '" />' +
            '</div>' +
            '<div class="screen-bottom">' +
              '<div class="text-box text-box-two-lines">' +
              '<span class="text-box-line">' + TEXT_BOX_S7_LINE1 + '</span>' +
              '<span class="text-box-line">' + TEXT_BOX_S7_LINE2 + '</span>' +
            '</div>' +
            '</div>' +
          '</div>' +
        '</div>'
      );
    }

    function playScreen7Next() {
      if (screen7State.index >= SCREEN7_AUDIO.length) {
        screen7State.isPlaying = false;
        screen7State.audioEnded = true;
        mount();
        setTimeout(function () {
          screen7State.nextClicked = true;
          mount();
          setTimeout(function () {
            screen7State.showStampPopup = true;
            mount();
            try {
              var stampAudio = new Audio('./fb5.mp3');
              stampAudio.play().catch(function () {});
            } catch (err) {}
          }, 250);
        }, 1200);
        return;
      }
      var audio = new Audio(SCREEN7_AUDIO[screen7State.index]);
      audio.onended = function () {
        screen7State.index++;
        playScreen7Next();
      };
      audio.onerror = function () {
        screen7State.index++;
        playScreen7Next();
      };
      screen7State.isPlaying = true;
      mount();
      var p = audio.play();
      if (p && typeof p.catch === 'function') p.catch(function () {});
    }

    function onScreen7Tap() {
      if (!screen7State.audioStarted) {
        screen7State.audioStarted = true;
        mount();
        playScreen7Next();
      }
    }

    function renderScreen2(state, onNext) {
      var recognitionDone = state.recognitionDone;
      var showCheckmark = state.showCheckmark;
      var isListening = state.isListening;

      var micHtml = '<button type="button" class="mic-btn" id="btn-mic" aria-label="Microphone"' +
        (isListening || recognitionDone ? ' disabled' : '') + '>' +
        '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>' +
        '</button>';

      var checkmarkHtml = showCheckmark
        ? '<div class="checkmark-popup" role="status">' +
            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' +
          '</div>'
        : '';

      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            '<div class="screen-main screen-main--vertical-center">' +
              '<p class="main-text' + (state.isListening || state.recognitionDone ? ' main-text--gradient' : '') + '">' + CENTER_TEXT_S2 + '</p>' +
            '</div>' +
            '<div class="screen-bottom">' + micHtml + '</div>' +
          '</div>' +
          checkmarkHtml +
        '</div>'
      );
    }

    function renderScreen4(state, onNext) {
      var recognitionDone = state.recognitionDone;
      var showCheckmark = state.showCheckmark;
      var isListening = state.isListening;
      var micHtml = '<button type="button" class="mic-btn" id="btn-mic" aria-label="Microphone"' +
        (isListening || recognitionDone ? ' disabled' : '') + '>' +
        '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>' +
        '</button>';
      var checkmarkHtml = showCheckmark
        ? '<div class="checkmark-popup" role="status">' +
            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' +
          '</div>'
        : '';
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            '<div class="screen-main screen-main--vertical-center">' +
              '<p class="main-text' + (state.isListening || state.recognitionDone ? ' main-text--gradient' : '') + '">' + CENTER_TEXT_S4 + '</p>' +
            '</div>' +
            '<div class="screen-bottom">' + micHtml + '</div>' +
          '</div>' +
          checkmarkHtml +
        '</div>'
      );
    }

    function renderScreen6(state, onNext) {
      var recognitionDone = state.recognitionDone;
      var showCheckmark = state.showCheckmark;
      var isListening = state.isListening;
      var micHtml = '<button type="button" class="mic-btn" id="btn-mic" aria-label="Microphone"' +
        (isListening || recognitionDone ? ' disabled' : '') + '>' +
        '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>' +
        '</button>';
      var checkmarkHtml = showCheckmark
        ? '<div class="checkmark-popup" role="status">' +
            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' +
          '</div>'
        : '';
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            '<div class="screen-main screen-main--vertical-center">' +
              '<p class="main-text' + (state.isListening || state.recognitionDone ? ' main-text--gradient' : '') + '">' + CENTER_TEXT_S6 + '</p>' +
            '</div>' +
            '<div class="screen-bottom">' + micHtml + '</div>' +
          '</div>' +
          checkmarkHtml +
        '</div>'
      );
    }

    var screenIndex = (window.location.hash === '#speed-up') ? 9 : 0;
    var screen2State = {
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen4State = {
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen6State = {
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen9State = {
      audioPlayed: false,
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen10State = {
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen11State = {
      audioPlayed: false,
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen12State = {
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen13State = {
      audioPlayed: false,
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen14State = {
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen15State = {
      audioPlayed: false,
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen16State = {
      audioPlayed: false,
      recognitionDone: false,
      showCheckmark: false,
      showSpeedUpPopup: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen17State = {
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen18State = {
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen20State = {
      audioPlayed: false,
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen21State = {
      audioPlayed: false,
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen22State = {
      audioPlayed: false,
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen23State = {
      audioPlayed: false,
      recognitionDone: false,
      showCheckmark: false,
      isListening: false,
      checkmarkShown: false
    };
    var screen24State = {
      audioPlayed: false,
      recognitionDone: false,
      showCheckmark: false,
      showSpeedUpPopup: false,
      isListening: false,
      checkmarkShown: false
    };

    function goNext() {
      if (screenIndex < 25) screenIndex++;
      mount();
    }

    function playPop() {
      try {
        var a = new Audio('./pop.mp3');
        a.play().catch(function () {});
      } catch (e) {}
    }

    function onRecognitionDone() {
      if (screen2State.checkmarkShown) return;
      screen2State.checkmarkShown = true;
      screen2State.recognitionDone = true;
      screen2State.showCheckmark = true;
      screen2State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () {
        screen2State.showCheckmark = false;
        mount();
      }, 1200);
      setTimeout(goNext, 1500);
    }

    function startRecognition() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        onRecognitionDone();
        return;
      }
      screen2State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone;
      rec.onend = function () {
        screen2State.isListening = false;
        if (!screen2State.checkmarkShown) onRecognitionDone();
        else mount();
      };
      rec.onerror = function () {
        screen2State.isListening = false;
        if (!screen2State.checkmarkShown) onRecognitionDone();
        else mount();
      };
      rec.start();
    }

    function onRecognitionDone4() {
      if (screen4State.checkmarkShown) return;
      screen4State.checkmarkShown = true;
      screen4State.recognitionDone = true;
      screen4State.showCheckmark = true;
      screen4State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () {
        screen4State.showCheckmark = false;
        mount();
      }, 1200);
      setTimeout(goNext, 1500);
    }

    function startRecognition4() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        onRecognitionDone4();
        return;
      }
      screen4State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone4;
      rec.onend = function () {
        screen4State.isListening = false;
        if (!screen4State.checkmarkShown) onRecognitionDone4();
        else mount();
      };
      rec.onerror = function () {
        screen4State.isListening = false;
        if (!screen4State.checkmarkShown) onRecognitionDone4();
        else mount();
      };
      rec.start();
    }

    function onRecognitionDone6() {
      if (screen6State.checkmarkShown) return;
      screen6State.checkmarkShown = true;
      screen6State.recognitionDone = true;
      screen6State.showCheckmark = true;
      screen6State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () {
        screen6State.showCheckmark = false;
        mount();
      }, 1200);
      setTimeout(goNext, 1500);
    }

    function startRecognition6() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        onRecognitionDone6();
        return;
      }
      screen6State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone6;
      rec.onend = function () {
        screen6State.isListening = false;
        if (!screen6State.checkmarkShown) onRecognitionDone6();
        else mount();
      };
      rec.onerror = function () {
        screen6State.isListening = false;
        if (!screen6State.checkmarkShown) onRecognitionDone6();
        else mount();
      };
      rec.start();
    }

    function onRecognitionDone9() {
      if (screen9State.checkmarkShown) return;
      screen9State.checkmarkShown = true;
      screen9State.recognitionDone = true;
      screen9State.showCheckmark = true;
      screen9State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () {
        screen9State.showCheckmark = false;
        mount();
      }, 1200);
      setTimeout(goNext, 1500);
    }

    function startRecognition9() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        onRecognitionDone9();
        return;
      }
      screen9State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone9;
      rec.onend = function () {
        screen9State.isListening = false;
        if (!screen9State.checkmarkShown) onRecognitionDone9();
        else mount();
      };
      rec.onerror = function () {
        screen9State.isListening = false;
        if (!screen9State.checkmarkShown) onRecognitionDone9();
        else mount();
      };
      rec.start();
    }

    function onScreen9Tap() {
      if (screen9State.audioPlayed) return;
      screen9State.audioPlayed = true;
      try {
        var a = new Audio(SCREEN9_AUDIO);
        a.playbackRate = 0.6;
        a.play().catch(function () {});
      } catch (e) {}
      mount();
    }

    function onRecognitionDone10() {
      if (screen10State.checkmarkShown) return;
      screen10State.checkmarkShown = true;
      screen10State.recognitionDone = true;
      screen10State.showCheckmark = true;
      screen10State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () {
        screen10State.showCheckmark = false;
        mount();
      }, 1200);
      setTimeout(goNext, 1500);
    }

    function startRecognition10() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        onRecognitionDone10();
        return;
      }
      screen10State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone10;
      rec.onend = function () {
        screen10State.isListening = false;
        if (!screen10State.checkmarkShown) onRecognitionDone10();
        else mount();
      };
      rec.onerror = function () {
        screen10State.isListening = false;
        if (!screen10State.checkmarkShown) onRecognitionDone10();
        else mount();
      };
      rec.start();
    }

    function onScreen11Tap() {
      if (screen11State.audioPlayed) return;
      screen11State.audioPlayed = true;
      try {
        var a = new Audio(SCREEN11_AUDIO);
        a.playbackRate = 0.6;
        a.play().catch(function () {});
      } catch (e) {}
      mount();
    }

    function onRecognitionDone11() {
      if (screen11State.checkmarkShown) return;
      screen11State.checkmarkShown = true;
      screen11State.recognitionDone = true;
      screen11State.showCheckmark = true;
      screen11State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () {
        screen11State.showCheckmark = false;
        mount();
      }, 1200);
      setTimeout(goNext, 1500);
    }

    function startRecognition11() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        onRecognitionDone11();
        return;
      }
      screen11State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone11;
      rec.onend = function () {
        screen11State.isListening = false;
        if (!screen11State.checkmarkShown) onRecognitionDone11();
        else mount();
      };
      rec.onerror = function () {
        screen11State.isListening = false;
        if (!screen11State.checkmarkShown) onRecognitionDone11();
        else mount();
      };
      rec.start();
    }

    function onRecognitionDone12() {
      if (screen12State.checkmarkShown) return;
      screen12State.checkmarkShown = true;
      screen12State.recognitionDone = true;
      screen12State.showCheckmark = true;
      screen12State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () {
        screen12State.showCheckmark = false;
        mount();
      }, 1200);
      setTimeout(goNext, 1500);
    }

    function startRecognition12() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        onRecognitionDone12();
        return;
      }
      screen12State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone12;
      rec.onend = function () {
        screen12State.isListening = false;
        if (!screen12State.checkmarkShown) onRecognitionDone12();
        else if (screenIndex === 21) mount();
      };
      rec.onerror = function () {
        screen12State.isListening = false;
        if (!screen12State.checkmarkShown) onRecognitionDone12();
        else if (screenIndex === 21) mount();
      };
      rec.start();
    }

    function onScreen13Tap() {
      if (screen13State.audioPlayed) return;
      screen13State.audioPlayed = true;
      try {
        var a = new Audio(SCREEN13_AUDIO);
        a.playbackRate = 0.6;
        a.play().catch(function () {});
      } catch (e) {}
      mount();
    }

    function onRecognitionDone13() {
      if (screen13State.checkmarkShown) return;
      screen13State.checkmarkShown = true;
      screen13State.recognitionDone = true;
      screen13State.showCheckmark = true;
      screen13State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () {
        screen13State.showCheckmark = false;
        mount();
      }, 1200);
      setTimeout(goNext, 1500);
    }

    function startRecognition13() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        onRecognitionDone13();
        return;
      }
      screen13State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone13;
      rec.onend = function () {
        screen13State.isListening = false;
        if (!screen13State.checkmarkShown) onRecognitionDone13();
        else mount();
      };
      rec.onerror = function () {
        screen13State.isListening = false;
        if (!screen13State.checkmarkShown) onRecognitionDone13();
        else mount();
      };
      rec.start();
    }

    function onRecognitionDone14() {
      if (screen14State.checkmarkShown) return;
      screen14State.checkmarkShown = true;
      screen14State.recognitionDone = true;
      screen14State.showCheckmark = true;
      screen14State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () {
        screen14State.showCheckmark = false;
        mount();
      }, 1200);
      setTimeout(goNext, 1500);
    }

    function startRecognition14() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        onRecognitionDone14();
        return;
      }
      screen14State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone14;
      rec.onend = function () {
        screen14State.isListening = false;
        if (!screen14State.checkmarkShown) onRecognitionDone14();
        else mount();
      };
      rec.onerror = function () {
        screen14State.isListening = false;
        if (!screen14State.checkmarkShown) onRecognitionDone14();
        else mount();
      };
      rec.start();
    }

    function onScreen15Tap() {
      if (screen15State.audioPlayed) return;
      screen15State.audioPlayed = true;
      try {
        var a = new Audio(SCREEN15_AUDIO);
        a.playbackRate = 0.6;
        a.play().catch(function () {});
      } catch (e) {}
      mount();
    }

    function onRecognitionDone15() {
      if (screen15State.checkmarkShown) return;
      screen15State.checkmarkShown = true;
      screen15State.recognitionDone = true;
      screen15State.showCheckmark = true;
      screen15State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () {
        screen15State.showCheckmark = false;
        mount();
      }, 1200);
      setTimeout(goNext, 1500);
    }

    function startRecognition15() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        onRecognitionDone15();
        return;
      }
      screen15State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone15;
      rec.onend = function () {
        screen15State.isListening = false;
        if (!screen15State.checkmarkShown) onRecognitionDone15();
        else mount();
      };
      rec.onerror = function () {
        screen15State.isListening = false;
        if (!screen15State.checkmarkShown) onRecognitionDone15();
        else mount();
      };
      rec.start();
    }

    function onScreen16Tap() {
      if (screen16State.audioPlayed) return;
      screen16State.audioPlayed = true;
      try {
        var a = new Audio(SCREEN16_AUDIO);
        a.playbackRate = 0.6;
        a.play().catch(function () {});
      } catch (e) {}
      mount();
    }

    function onRecognitionDone16() {
      if (screen16State.checkmarkShown) return;
      screen16State.checkmarkShown = true;
      screen16State.recognitionDone = true;
      screen16State.showCheckmark = true;
      screen16State.isListening = false;
      playDingDong();
      if (screenIndex !== 14) return;
      mount();
      setTimeout(function () {
        if (screenIndex !== 14) return;
        screen16State.showCheckmark = false;
        screen16State.showSpeedUpPopup = true;
        playNotificationSound();
        requestAnimationFrame(function () {
          updateScreen16OverlayOnly(screen16State, 'Speed Up!');
        });
        setTimeout(function () {
          if (screenIndex === 14) goNext();
        }, 1500);
      }, 1200);
    }

    function startRecognition16() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        onRecognitionDone16();
        return;
      }
      screen16State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone16;
      rec.onend = function () {
        screen16State.isListening = false;
        if (!screen16State.checkmarkShown) onRecognitionDone16();
        else if (screenIndex !== 14) setTimeout(function () { mount(); }, 0);
      };
      rec.onerror = function () {
        screen16State.isListening = false;
        if (!screen16State.checkmarkShown) onRecognitionDone16();
        else if (screenIndex !== 14) setTimeout(function () { mount(); }, 0);
      };
      rec.start();
    }

    function onRecognitionDone17() {
      if (screen17State.checkmarkShown) return;
      screen17State.checkmarkShown = true;
      screen17State.recognitionDone = true;
      screen17State.showCheckmark = true;
      screen17State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () {
        screen17State.showCheckmark = false;
        mount();
      }, 1200);
      setTimeout(goNext, 1500);
    }

    function startRecognition17() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        onRecognitionDone17();
        return;
      }
      screen17State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone17;
      rec.onend = function () {
        screen17State.isListening = false;
        if (!screen17State.checkmarkShown) onRecognitionDone17();
        else mount();
      };
      rec.onerror = function () {
        screen17State.isListening = false;
        if (!screen17State.checkmarkShown) onRecognitionDone17();
        else mount();
      };
      rec.start();
    }

    function onRecognitionDone18() {
      if (screen18State.checkmarkShown) return;
      screen18State.checkmarkShown = true;
      screen18State.recognitionDone = true;
      screen18State.showCheckmark = true;
      screen18State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () {
        screen18State.showCheckmark = false;
        mount();
      }, 1200);
      setTimeout(goNext, 1500);
    }

    function startRecognition18() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        onRecognitionDone18();
        return;
      }
      screen18State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone18;
      rec.onend = function () {
        screen18State.isListening = false;
        if (!screen18State.checkmarkShown) onRecognitionDone18();
        else mount();
      };
      rec.onerror = function () {
        screen18State.isListening = false;
        if (!screen18State.checkmarkShown) onRecognitionDone18();
        else mount();
      };
      rec.start();
    }

    function onScreen20Tap() {
      if (screen20State.audioPlayed) return;
      screen20State.audioPlayed = true;
      try {
        var a = new Audio(SCREEN9_AUDIO);
        a.playbackRate = 1;
        a.play().catch(function () {});
      } catch (e) {}
      mount();
    }
    function onRecognitionDone20() {
      if (screen20State.checkmarkShown) return;
      screen20State.checkmarkShown = true;
      screen20State.recognitionDone = true;
      screen20State.showCheckmark = true;
      screen20State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () { screen20State.showCheckmark = false; mount(); }, 1200);
      setTimeout(goNext, 1500);
    }
    function startRecognition20() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) { onRecognitionDone20(); return; }
      screen20State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone20;
      rec.onend = function () { screen20State.isListening = false; if (!screen20State.checkmarkShown) onRecognitionDone20(); else mount(); };
      rec.onerror = function () { screen20State.isListening = false; if (!screen20State.checkmarkShown) onRecognitionDone20(); else mount(); };
      rec.start();
    }

    function onScreen21Tap() {
      if (screen21State.audioPlayed) return;
      screen21State.audioPlayed = true;
      try {
        var a = new Audio(SCREEN11_AUDIO);
        a.playbackRate = 1;
        a.play().catch(function () {});
      } catch (e) {}
      mount();
    }
    function onRecognitionDone21() {
      if (screen21State.checkmarkShown) return;
      screen21State.checkmarkShown = true;
      screen21State.recognitionDone = true;
      screen21State.showCheckmark = true;
      screen21State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () { screen21State.showCheckmark = false; mount(); }, 1200);
      setTimeout(goNext, 1500);
    }
    function startRecognition21() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) { onRecognitionDone21(); return; }
      screen21State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone21;
      rec.onend = function () { screen21State.isListening = false; if (!screen21State.checkmarkShown) onRecognitionDone21(); else mount(); };
      rec.onerror = function () { screen21State.isListening = false; if (!screen21State.checkmarkShown) onRecognitionDone21(); else mount(); };
      rec.start();
    }

    function onScreen22Tap() {
      if (screen22State.audioPlayed) return;
      screen22State.audioPlayed = true;
      try {
        var a = new Audio(SCREEN13_AUDIO);
        a.playbackRate = 1;
        a.play().catch(function () {});
      } catch (e) {}
      mount();
    }
    function onRecognitionDone22() {
      if (screen22State.checkmarkShown) return;
      screen22State.checkmarkShown = true;
      screen22State.recognitionDone = true;
      screen22State.showCheckmark = true;
      screen22State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () { screen22State.showCheckmark = false; mount(); }, 1200);
      setTimeout(goNext, 1500);
    }
    function startRecognition22() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) { onRecognitionDone22(); return; }
      screen22State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone22;
      rec.onend = function () { screen22State.isListening = false; if (!screen22State.checkmarkShown) onRecognitionDone22(); else mount(); };
      rec.onerror = function () { screen22State.isListening = false; if (!screen22State.checkmarkShown) onRecognitionDone22(); else mount(); };
      rec.start();
    }

    function onScreen23Tap() {
      if (screen23State.audioPlayed) return;
      screen23State.audioPlayed = true;
      try {
        var a = new Audio(SCREEN15_AUDIO);
        a.playbackRate = 1;
        a.play().catch(function () {});
      } catch (e) {}
      mount();
    }
    function onRecognitionDone23() {
      if (screen23State.checkmarkShown) return;
      screen23State.checkmarkShown = true;
      screen23State.recognitionDone = true;
      screen23State.showCheckmark = true;
      screen23State.isListening = false;
      playDingDong();
      mount();
      setTimeout(function () { screen23State.showCheckmark = false; mount(); }, 1200);
      setTimeout(goNext, 1500);
    }
    function startRecognition23() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) { onRecognitionDone23(); return; }
      screen23State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone23;
      rec.onend = function () { screen23State.isListening = false; if (!screen23State.checkmarkShown) onRecognitionDone23(); else mount(); };
      rec.onerror = function () { screen23State.isListening = false; if (!screen23State.checkmarkShown) onRecognitionDone23(); else mount(); };
      rec.start();
    }

    function onScreen24Tap() {
      if (screen24State.audioPlayed) return;
      screen24State.audioPlayed = true;
      try {
        var a = new Audio(SCREEN16_AUDIO);
        a.playbackRate = 1;
        a.play().catch(function () {});
      } catch (e) {}
      mount();
    }
    function onRecognitionDone24() {
      if (screen24State.checkmarkShown) return;
      screen24State.checkmarkShown = true;
      screen24State.recognitionDone = true;
      screen24State.showCheckmark = true;
      screen24State.isListening = false;
      playDingDong();
      setTimeout(function () { mount(); }, 0);
      setTimeout(function () {
        screen24State.showCheckmark = false;
        screen24State.showSpeedUpPopup = true;
        playNotificationSound();
        updateScreen16OverlayOnly(screen24State, 'Your turn!');
        setTimeout(goNext, 1500);
      }, 1200);
    }
    function startRecognition24() {
      var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) { onRecognitionDone24(); return; }
      screen24State.isListening = true;
      mount();
      var rec = new SR();
      rec.continuous = false;
      rec.lang = 'en-US';
      rec.interimResults = false;
      rec.onresult = onRecognitionDone24;
      rec.onend = function () { screen24State.isListening = false; if (!screen24State.checkmarkShown) onRecognitionDone24(); else setTimeout(function () { mount(); }, 0); };
      rec.onerror = function () { screen24State.isListening = false; if (!screen24State.checkmarkShown) onRecognitionDone24(); else setTimeout(function () { mount(); }, 0); };
      rec.start();
    }

    function renderScreen9(state, fastActive) {
      var recognitionDone = state.recognitionDone;
      var showCheckmark = state.showCheckmark;
      var isListening = state.isListening;
      var micHtml = '<button type="button" class="mic-btn" id="btn-mic" aria-label="Microphone"' +
        (isListening || recognitionDone ? ' disabled' : '') + '>' +
        '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>' +
        '</button>';
      var checkmarkHtml = showCheckmark
        ? '<div class="checkmark-popup" role="status">' +
            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' +
          '</div>'
        : '';
      var gradLine1 = (isListening || recognitionDone) ? ' main-text--gradient' : '';
      var speedCls = fastActive ? ' speed-display--fast-active' : '';
      var fastCls = fastActive ? ' speed-display-item--fast' : '';
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            '<div class="speed-display' + speedCls + '">' +
              '<span class="speed-display-item speed-display-item--slow">Slow</span>' +
              '<span class="speed-display-sep" aria-hidden>/</span>' +
              '<span class="speed-display-item' + fastCls + '">Fast</span>' +
            '</div>' +
            '<div class="screen-main screen-main--vertical-center">' +
              '<p class="main-text main-text--two-lines' + gradLine1 + '">' + CENTER_TEXT_S9_LINE1 + '</p>' +
              '<p class="main-text main-text--two-lines main-text--sub">' + CENTER_TEXT_S9_LINE2 + '</p>' +
            '</div>' +
            '<div class="screen-bottom">' + micHtml + '</div>' +
          '</div>' +
          checkmarkHtml +
        '</div>'
      );
    }

    function renderScreen10(state, hideSpeedDisplay) {
      var recognitionDone = state.recognitionDone;
      var showCheckmark = state.showCheckmark;
      var isListening = state.isListening;
      var micHtml = '<button type="button" class="mic-btn" id="btn-mic" aria-label="Microphone"' +
        (isListening || recognitionDone ? ' disabled' : '') + '>' +
        '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>' +
        '</button>';
      var checkmarkHtml = showCheckmark
        ? '<div class="checkmark-popup" role="status">' +
            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' +
          '</div>'
        : '';
      var englishHtml = (isListening || recognitionDone)
        ? '<p class="main-text main-text--two-lines main-text--gradient">' + CENTER_TEXT_S10_LINE1 + '</p>'
        : '';
      var speedDisplayHtml = hideSpeedDisplay ? '' : '<div class="speed-display">' +
        '<span class="speed-display-item speed-display-item--slow">Slow</span>' +
        '<span class="speed-display-sep" aria-hidden>/</span>' +
        '<span class="speed-display-item">Fast</span></div>';
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            speedDisplayHtml +
            '<div class="screen-main screen-main--vertical-center">' +
              englishHtml +
              '<p class="main-text main-text--two-lines main-text--sub">' + CENTER_TEXT_S10_LINE2 + '</p>' +
            '</div>' +
            '<div class="screen-bottom">' + micHtml + '</div>' +
          '</div>' +
          checkmarkHtml +
        '</div>'
      );
    }

    // Index 12 – Type 2-1: audio on tap, English + Korean both visible, mic → gradient on English
    function renderScreen11(state, fastActive) {
      var recognitionDone = state.recognitionDone;
      var showCheckmark = state.showCheckmark;
      var isListening = state.isListening;
      var micHtml = '<button type="button" class="mic-btn" id="btn-mic" aria-label="Microphone"' +
        (isListening || recognitionDone ? ' disabled' : '') + '>' +
        '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>' +
        '</button>';
      var checkmarkHtml = showCheckmark
        ? '<div class="checkmark-popup" role="status">' +
            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' +
          '</div>'
        : '';
      var gradLine1 = (isListening || recognitionDone) ? ' main-text--gradient' : '';
      var speedCls = fastActive ? ' speed-display--fast-active' : '';
      var fastCls = fastActive ? ' speed-display-item--fast' : '';
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            '<div class="speed-display' + speedCls + '">' +
              '<span class="speed-display-item speed-display-item--slow">Slow</span>' +
              '<span class="speed-display-sep" aria-hidden>/</span>' +
              '<span class="speed-display-item' + fastCls + '">Fast</span>' +
            '</div>' +
            '<div class="screen-main screen-main--vertical-center">' +
              '<p class="main-text main-text--two-lines' + gradLine1 + '">' + CENTER_TEXT_S11_LINE1 + '</p>' +
              '<p class="main-text main-text--two-lines main-text--sub">' + CENTER_TEXT_S11_LINE2 + '</p>' +
            '</div>' +
            '<div class="screen-bottom">' + micHtml + '</div>' +
          '</div>' +
          checkmarkHtml +
        '</div>'
      );
    }

    function renderScreen12(state, hideSpeedDisplay) {
      var recognitionDone = state.recognitionDone;
      var showCheckmark = state.showCheckmark;
      var isListening = state.isListening;
      var micHtml = '<button type="button" class="mic-btn" id="btn-mic" aria-label="Microphone"' +
        (isListening || recognitionDone ? ' disabled' : '') + '>' +
        '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>' +
        '</button>';
      var checkmarkHtml = showCheckmark
        ? '<div class="checkmark-popup" role="status">' +
            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' +
          '</div>'
        : '';
      var englishHtml = (isListening || recognitionDone)
        ? '<p class="main-text main-text--two-lines main-text--gradient">' + CENTER_TEXT_S12_LINE1 + '</p>'
        : '';
      var speedDisplayHtml = hideSpeedDisplay ? '' : '<div class="speed-display">' +
        '<span class="speed-display-item speed-display-item--slow">Slow</span>' +
        '<span class="speed-display-sep" aria-hidden>/</span>' +
        '<span class="speed-display-item">Fast</span></div>';
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            speedDisplayHtml +
            '<div class="screen-main screen-main--vertical-center">' +
              englishHtml +
              '<p class="main-text main-text--two-lines main-text--sub">' + CENTER_TEXT_S12_LINE2 + '</p>' +
            '</div>' +
            '<div class="screen-bottom">' + micHtml + '</div>' +
          '</div>' +
          checkmarkHtml +
        '</div>'
      );
    }

    function renderScreen13(state, fastActive) {
      var recognitionDone = state.recognitionDone;
      var showCheckmark = state.showCheckmark;
      var isListening = state.isListening;
      var micHtml = '<button type="button" class="mic-btn" id="btn-mic" aria-label="Microphone"' +
        (isListening || recognitionDone ? ' disabled' : '') + '>' +
        '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>' +
        '</button>';
      var checkmarkHtml = showCheckmark
        ? '<div class="checkmark-popup" role="status">' +
            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' +
          '</div>'
        : '';
      var showFill = isListening || recognitionDone;
      var line1Html = showFill
        ? '<p class="main-text main-text--two-lines">' +
            '<span class="main-text--gradient-sequential">' + CENTER_TEXT_S13_LINE1_PREFIX + CENTER_TEXT_S13_FILL + '.</span>' +
          '</p>'
        : '<p class="main-text main-text--two-lines">' + CENTER_TEXT_S13_LINE1_PREFIX + '<span class="main-text-blank-box"><span class="main-text-blank-box__hint">' + CENTER_TEXT_S13_FILL + '</span></span>.</p>';
      var speedCls = fastActive ? ' speed-display--fast-active' : '';
      var fastCls = fastActive ? ' speed-display-item--fast' : '';
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            '<div class="speed-display' + speedCls + '">' +
              '<span class="speed-display-item speed-display-item--slow">Slow</span>' +
              '<span class="speed-display-sep" aria-hidden>/</span>' +
              '<span class="speed-display-item' + fastCls + '">Fast</span>' +
            '</div>' +
            '<div class="screen-main screen-main--vertical-center">' +
              line1Html +
              '<p class="main-text main-text--two-lines main-text--sub">' + CENTER_TEXT_S13_LINE2 + '</p>' +
            '</div>' +
            '<div class="screen-bottom">' + micHtml + '</div>' +
          '</div>' +
          checkmarkHtml +
        '</div>'
      );
    }

    function renderScreen14(state, hideSpeedDisplay) {
      var recognitionDone = state.recognitionDone;
      var showCheckmark = state.showCheckmark;
      var isListening = state.isListening;
      var micHtml = '<button type="button" class="mic-btn" id="btn-mic" aria-label="Microphone"' +
        (isListening || recognitionDone ? ' disabled' : '') + '>' +
        '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>' +
        '</button>';
      var checkmarkHtml = showCheckmark
        ? '<div class="checkmark-popup" role="status">' +
            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' +
          '</div>'
        : '';
      var showFill = isListening || recognitionDone;
      var englishHtml = showFill
        ? '<p class="main-text main-text--two-lines">' +
            '<span class="main-text--gradient-sequential">' + CENTER_TEXT_S13_LINE1_PREFIX + CENTER_TEXT_S13_FILL + '.</span>' +
          '</p>'
        : '';
      var speedDisplayHtml = hideSpeedDisplay ? '' : '<div class="speed-display">' +
        '<span class="speed-display-item speed-display-item--slow">Slow</span>' +
        '<span class="speed-display-sep" aria-hidden>/</span>' +
        '<span class="speed-display-item">Fast</span></div>';
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            speedDisplayHtml +
            '<div class="screen-main screen-main--vertical-center">' +
              englishHtml +
              '<p class="main-text main-text--two-lines main-text--sub">' + CENTER_TEXT_S13_LINE2 + '</p>' +
            '</div>' +
            '<div class="screen-bottom">' + micHtml + '</div>' +
          '</div>' +
          checkmarkHtml +
        '</div>'
      );
    }

    function renderScreen15(state, fastActive) {
      var recognitionDone = state.recognitionDone;
      var showCheckmark = state.showCheckmark;
      var isListening = state.isListening;
      var micHtml = '<button type="button" class="mic-btn" id="btn-mic" aria-label="Microphone"' +
        (isListening || recognitionDone ? ' disabled' : '') + '>' +
        '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>' +
        '</button>';
      var checkmarkHtml = showCheckmark
        ? '<div class="checkmark-popup" role="status">' +
            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' +
          '</div>'
        : '';
      var showFill = isListening || recognitionDone;
      var line1Html = showFill
        ? '<p class="main-text main-text--two-lines">' +
            '<span class="main-text--gradient-sequential">' + CENTER_TEXT_S15_LINE1_PREFIX + CENTER_TEXT_S15_FILL + '.</span>' +
          '</p>'
        : '<p class="main-text main-text--two-lines">' + CENTER_TEXT_S15_LINE1_PREFIX + '<span class="main-text-blank-box"><span class="main-text-blank-box__hint">' + CENTER_TEXT_S15_FILL + '</span></span>.</p>';
      var speedCls = fastActive ? ' speed-display--fast-active' : '';
      var fastCls = fastActive ? ' speed-display-item--fast' : '';
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            '<div class="speed-display' + speedCls + '">' +
              '<span class="speed-display-item speed-display-item--slow">Slow</span>' +
              '<span class="speed-display-sep" aria-hidden>/</span>' +
              '<span class="speed-display-item' + fastCls + '">Fast</span>' +
            '</div>' +
            '<div class="screen-main screen-main--vertical-center">' +
              line1Html +
              '<p class="main-text main-text--two-lines main-text--sub">' + CENTER_TEXT_S15_LINE2 + '</p>' +
            '</div>' +
            '<div class="screen-bottom">' + micHtml + '</div>' +
          '</div>' +
          checkmarkHtml +
        '</div>'
      );
    }

    function renderScreen16(state, fastActive, popupText) {
      var recognitionDone = state.recognitionDone;
      var showCheckmark = state.showCheckmark;
      var showSpeedUpPopup = state.showSpeedUpPopup;
      var isListening = state.isListening;
      var micHtml = '<button type="button" class="mic-btn" id="btn-mic" aria-label="Microphone"' +
        (isListening || recognitionDone ? ' disabled' : '') + '>' +
        '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>' +
        '</button>';
      var checkmarkHtml = '';
      var speedUpPopupHtml = '';
      var showFill = isListening || recognitionDone;
      var line1Html = showFill
        ? '<p class="main-text main-text--two-lines">' +
            '<span class="main-text--gradient-sequential">' + CENTER_TEXT_S16_LINE1_PREFIX + CENTER_TEXT_S16_FILL + '.</span>' +
          '</p>'
        : '<p class="main-text main-text--two-lines">' + CENTER_TEXT_S16_LINE1_PREFIX + '<span class="main-text-blank-box"><span class="main-text-blank-box__hint">' + CENTER_TEXT_S16_FILL + '</span></span>.</p>';
      var speedCls = fastActive ? ' speed-display--fast-active' : '';
      var fastCls = fastActive ? ' speed-display-item--fast' : '';
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            '<div class="speed-display' + speedCls + '">' +
              '<span class="speed-display-item speed-display-item--slow">Slow</span>' +
              '<span class="speed-display-sep" aria-hidden>/</span>' +
              '<span class="speed-display-item' + fastCls + '">Fast</span>' +
            '</div>' +
            '<div class="screen-main screen-main--vertical-center">' +
              line1Html +
              '<p class="main-text main-text--two-lines main-text--sub">' + CENTER_TEXT_S16_LINE2 + '</p>' +
            '</div>' +
            '<div class="screen-bottom">' + micHtml + '</div>' +
          '</div>' +
          checkmarkHtml +
          speedUpPopupHtml +
        '</div>'
      );
    }

    function getScreen16OverlayHtml(state, popupText) {
      if (state.showCheckmark) {
        return '<div class="checkmark-popup" role="status">' +
          '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>';
      }
      if (state.showSpeedUpPopup) {
        return '<div class="speed-up-popup" role="status">' + (popupText !== undefined ? popupText : 'Speed Up!') + '</div>';
      }
      return '';
    }

    function updateScreen16OverlayOnly(state, popupText) {
      var overlayEl = document.getElementById('app-overlay');
      if (!overlayEl) {
        overlayEl = document.createElement('div');
        overlayEl.id = 'app-overlay';
        overlayEl.className = 'app-overlay';
        document.body.appendChild(overlayEl);
      }
      overlayEl.innerHTML = getScreen16OverlayHtml(state, popupText);
      var speedUpPopup = overlayEl.querySelector('.speed-up-popup');
      if (speedUpPopup) speedUpPopup.addEventListener('click', function (e) { e.stopPropagation(); goNext(); });
    }

    function renderScreen17(state, hideSpeedDisplay) {
      var recognitionDone = state.recognitionDone;
      var showCheckmark = state.showCheckmark;
      var isListening = state.isListening;
      var micHtml = '<button type="button" class="mic-btn" id="btn-mic" aria-label="Microphone"' +
        (isListening || recognitionDone ? ' disabled' : '') + '>' +
        '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>' +
        '</button>';
      var checkmarkHtml = showCheckmark
        ? '<div class="checkmark-popup" role="status">' +
            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' +
          '</div>'
        : '';
      var showFill = isListening || recognitionDone;
      var englishHtml = showFill
        ? '<p class="main-text main-text--two-lines">' +
            '<span class="main-text--gradient-sequential">' + CENTER_TEXT_S17_LINE1_PREFIX + CENTER_TEXT_S17_FILL + '.</span>' +
          '</p>'
        : '';
      var speedDisplayHtml = hideSpeedDisplay ? '' : '<div class="speed-display">' +
        '<span class="speed-display-item speed-display-item--slow">Slow</span>' +
        '<span class="speed-display-sep" aria-hidden>/</span>' +
        '<span class="speed-display-item">Fast</span></div>';
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            speedDisplayHtml +
            '<div class="screen-main screen-main--vertical-center">' +
              englishHtml +
              '<p class="main-text main-text--two-lines main-text--sub">' + CENTER_TEXT_S17_LINE2 + '</p>' +
            '</div>' +
            '<div class="screen-bottom">' + micHtml + '</div>' +
          '</div>' +
          checkmarkHtml +
        '</div>'
      );
    }

    // Index 15 – Type 2-4: 나는 피터예요. (English hidden) → mic → I am Peter.
    function renderScreen18(state, hideSpeedDisplay) {
      var recognitionDone = state.recognitionDone;
      var showCheckmark = state.showCheckmark;
      var isListening = state.isListening;
      var micHtml = '<button type="button" class="mic-btn" id="btn-mic" aria-label="Microphone"' +
        (isListening || recognitionDone ? ' disabled' : '') + '>' +
        '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>' +
        '</button>';
      var checkmarkHtml = showCheckmark
        ? '<div class="checkmark-popup" role="status">' +
            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' +
          '</div>'
        : '';
      var showFill = isListening || recognitionDone;
      var englishHtml = showFill
        ? '<p class="main-text main-text--two-lines">' +
            '<span class="main-text--gradient-sequential">' + CENTER_TEXT_S18_LINE1_PREFIX + CENTER_TEXT_S18_FILL + '.</span>' +
          '</p>'
        : '';
      var speedDisplayHtml = hideSpeedDisplay ? '' : '<div class="speed-display">' +
        '<span class="speed-display-item speed-display-item--slow">Slow</span>' +
        '<span class="speed-display-sep" aria-hidden>/</span>' +
        '<span class="speed-display-item">Fast</span></div>';
      return (
        '<div class="screen-content">' +
          '<div class="screen-center">' +
            '<div class="topic-box">' + TOPIC_TEXT + '</div>' +
            speedDisplayHtml +
            '<div class="screen-main screen-main--vertical-center">' +
              englishHtml +
              '<p class="main-text main-text--two-lines main-text--sub">' + CENTER_TEXT_S18_LINE2 + '</p>' +
            '</div>' +
            '<div class="screen-bottom">' + micHtml + '</div>' +
          '</div>' +
          checkmarkHtml +
        '</div>'
      );
    }

    function mount() {
      var el = document.getElementById('app-content');
      if (!el) return;
      var header = document.getElementById('app-header');
      var overlayEl = document.getElementById('app-overlay');
      if (overlayEl && screenIndex !== 14 && screenIndex !== 19) overlayEl.innerHTML = '';

      if (screenIndex === 0) {
        if (header) header.style.display = 'none';
        el.innerHTML = renderCornerSelect();
        var btnStep1 = document.getElementById('btn-step1');
        if (btnStep1) btnStep1.onclick = function () { screenIndex = 1; mount(); };
        var btnStep2 = document.getElementById('btn-step2');
        if (btnStep2) btnStep2.onclick = function () { screenIndex = 9; mount(); };
        return;
      }

      if (screenIndex === 1) {
        if (header) header.style.display = 'none';
        el.innerHTML = renderCornerIntro('STEP 1', CORNER_TITLE);
        el.querySelector('.corner-intro-screen').addEventListener('click', goNext);
        return;
      }

      if (screenIndex === 9) {
        if (header) header.style.display = 'none';
        el.innerHTML = renderCornerIntro(CORNER_STEP_2, CORNER_TITLE_2);
        el.querySelector('.corner-intro-screen').addEventListener('click', goNext);
        return;
      }

      if (header) header.style.display = '';

      if (screenIndex === 2) {
        el.innerHTML = renderScreen1(screen1State);
        el.querySelector('.screen-content').addEventListener('click', onScreen1Tap);
        return;
      }

      if (screenIndex === 4) {
        el.innerHTML = renderScreen3(screen3State);
        el.querySelector('.screen-content').addEventListener('click', onScreen3Tap);
        return;
      }

      if (screenIndex === 5) {
        el.innerHTML = renderScreen4(screen4State, goNext);
        playPop();
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = startRecognition4;
        return;
      }

      if (screenIndex === 6) {
        el.innerHTML = renderScreen5(screen5State);
        el.querySelector('.screen-content').addEventListener('click', onScreen5Tap);
        return;
      }

      if (screenIndex === 7) {
        el.innerHTML = renderScreen6(screen6State, goNext);
        playPop();
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = startRecognition6;
        return;
      }

      if (screenIndex === 8) {
        el.innerHTML = renderScreen7(screen7State);
        el.querySelector('.screen-content').addEventListener('click', onScreen7Tap);
        var stampPopup = el.querySelector('.screen7-stamp-popup');
        if (stampPopup) stampPopup.onclick = function (e) { e.stopPropagation(); goNext(); };
        return;
      }

      if (screenIndex === 10) {
        el.innerHTML = renderScreen9(screen9State);
        el.querySelector('.screen-content').addEventListener('click', onScreen9Tap);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition9(); };
        return;
      }

      if (screenIndex === 11) {
        el.innerHTML = renderScreen11(screen11State);
        el.querySelector('.screen-content').addEventListener('click', onScreen11Tap);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition11(); };
        return;
      }

      if (screenIndex === 12) {
        el.innerHTML = renderScreen13(screen13State);
        el.querySelector('.screen-content').addEventListener('click', onScreen13Tap);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition13(); };
        return;
      }

      if (screenIndex === 13) {
        el.innerHTML = renderScreen15(screen15State);
        el.querySelector('.screen-content').addEventListener('click', onScreen15Tap);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition15(); };
        return;
      }

      if (screenIndex === 14) {
        el.innerHTML = renderScreen16(screen16State);
        var screenContent = el.querySelector('.screen-content');
        if (screenContent) screenContent.addEventListener('click', onScreen16Tap);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition16(); };
        if (overlayEl) {
          overlayEl.innerHTML = getScreen16OverlayHtml(screen16State, 'Speed Up!');
          var speedUpPopup = overlayEl.querySelector('.speed-up-popup');
          if (speedUpPopup) speedUpPopup.addEventListener('click', function (e) { e.stopPropagation(); goNext(); });
        }
        return;
      }

      if (screenIndex === 15) {
        el.innerHTML = renderScreen9(screen20State, true);
        el.querySelector('.screen-content').addEventListener('click', onScreen20Tap);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition20(); };
        return;
      }

      if (screenIndex === 16) {
        el.innerHTML = renderScreen11(screen21State, true);
        el.querySelector('.screen-content').addEventListener('click', onScreen21Tap);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition21(); };
        return;
      }

      if (screenIndex === 17) {
        el.innerHTML = renderScreen13(screen22State, true);
        el.querySelector('.screen-content').addEventListener('click', onScreen22Tap);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition22(); };
        return;
      }

      if (screenIndex === 18) {
        el.innerHTML = renderScreen15(screen23State, true);
        el.querySelector('.screen-content').addEventListener('click', onScreen23Tap);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition23(); };
        return;
      }

      if (screenIndex === 19) {
        el.innerHTML = renderScreen16(screen24State, true, 'Your turn!');
        el.querySelector('.screen-content').addEventListener('click', onScreen24Tap);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition24(); };
        if (overlayEl) {
          overlayEl.innerHTML = getScreen16OverlayHtml(screen24State, 'Your turn!');
          var speedUpPopup = overlayEl.querySelector('.speed-up-popup');
          if (speedUpPopup) speedUpPopup.addEventListener('click', function (e) { e.stopPropagation(); goNext(); });
        }
        return;
      }

      if (screenIndex === 20) {
        el.innerHTML = renderScreen10(screen10State, true);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition10(); };
        return;
      }

      if (screenIndex === 21) {
        el.innerHTML = renderScreen12(screen12State, true);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition12(); };
        return;
      }

      if (screenIndex === 22) {
        var html22 = renderScreen18(screen18State, true);
        el.innerHTML = html22;
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition18(); };
        setTimeout(function () {
          if (screenIndex !== 22) return;
          var el22 = document.getElementById('app-content');
          if (el22) { el22.innerHTML = html22; var m = document.getElementById('btn-mic'); if (m) m.onclick = function (e) { e.stopPropagation(); startRecognition18(); }; }
        }, 0);
        return;
      }

      if (screenIndex === 23) {
        el.innerHTML = renderScreen14(screen14State, true);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition14(); };
        return;
      }

      if (screenIndex === 24) {
        el.innerHTML = renderScreen17(screen17State, true);
        var btnMic = document.getElementById('btn-mic');
        if (btnMic) btnMic.onclick = function (e) { e.stopPropagation(); startRecognition17(); };
        return;
      }

      if (screenIndex === 25) {
        el.innerHTML = '<div class="screen-content"></div>';
        return;
      }

      el.innerHTML = renderScreen2(screen2State, goNext);
      playPop();

      var btnMic = document.getElementById('btn-mic');
      if (btnMic) btnMic.onclick = startRecognition;
    }

    // Initial render – Screen 1: tap to start audio (screen1-1, then screen1-2)
    mount();
  </script>
</body>
</html>
